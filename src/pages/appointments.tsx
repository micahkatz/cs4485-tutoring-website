import React from 'react'
import Head from 'next/head'
import NavBar from '../components/NavBar'
import AppointmentCard from '../components/AppointmentCard'
import Link from 'next/link'
import { appointment } from '@prisma/client'
import axios from 'axios'
import { UserContext } from '@/context/userContext'
import { AppointmentWithStrings } from '@/types/globals'

type Props = {}

const Appointments = (props) => {
    const userContext = React.useContext(UserContext)

    React.useEffect(() => {
        userContext.getAppointments()
    }, [userContext?.currUser?.userID])

    const { appointments } = userContext
    return (
        <>
            <Head>
                <title>My Appointments</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main>
                <NavBar />
                <h1 className='text-center text-3xl mb-6 font-bold'>My Appointments</h1>
                <div className='flex flex-col items-center'>
                    <div className='gird grid-cols-1 justify-center w-full max-w-[66%] lg:max-w-[50%] xl:max-w-[40%]'>
                        {
                            appointments.length > 0 ? (
                                <div className='w-full'>
                                    <h2 className='text-center text-2xl'>Next:</h2>
                                    <AppointmentCard className='w-full'
                                        apptId={appointments?.[0].appointID}
                                        userId={appointments?.[0].fk_userID}
                                        tutorId={appointments?.[0].fk_tutorID}
                                        startDT={appointments?.[0].startDT}
                                        endDT={appointments?.[0].endDT}
                                    />
                                </div>
                            ) : <div className='w-full'>
                                <h2 className='text-center text-xl'>You have no upcoming appointments</h2>
                            </div>
                        }
                        {
                            appointments.length > 1 && (
                                <div className='w-full'>
                                    <h2 className='text-center text-2xl'>Upcoming:</h2>
                                    {
                                        appointments.map((item, index) => (
                                            index > 0 ? (
                                                <AppointmentCard
                                                    className='w-full'
                                                    apptId={item.appointID}
                                                    userId={item.fk_userID}
                                                    tutorId={item.fk_tutorID}
                                                    startDT={item.startDT}
                                                    endDT={item.endDT}
                                                />
                                            ) : <></>
                                        ))
                                    }
                                </div>
                            )
                        }
                    </div>
                </div>
            </main>
        </>
    )
}

export default Appointments